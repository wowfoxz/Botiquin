import*as e from"@react-pdf/primitives";export*from"@react-pdf/primitives";import r from"queue";import{useRef as o,useState as t,useEffect as n,useCallback as i,forwardRef as a}from"react";import l from"@react-pdf/font";import c from"@react-pdf/render";import d from"@react-pdf/pdfkit";import s from"@react-pdf/layout";import{upperFirst as u}from"@react-pdf/fns";import p from"@react-pdf/reconciler";import{jsx as m}from"react/jsx-runtime";const f=(e,r)=>{let{style:o,children:t,...n}=r;return{type:e,box:{},style:o||{},props:n||{},children:[]}},v=e=>({type:"TEXT_INSTANCE",value:e}),h=(e,r)=>{const o="TEXT"===e.type||"LINK"===e.type||"TSPAN"===e.type||"NOTE"===e.type;"TEXT_INSTANCE"!==r.type||o?e.children.push(r):console.warn(`Invalid '${r.value}' string child outside <Text> component`)},y=(e,r)=>{"ROOT"===e.type?e.document=r:h(e,r)},T=(e,r,o)=>{var t;const n=null===(t=e.children)||void 0===t?void 0:t.indexOf(o);void 0!==n&&-1!==n&&r&&e.children.splice(n,0,r)},b=(e,r)=>{var o;const t=null===(o=e.children)||void 0===o?void 0:o.indexOf(r);void 0!==t&&-1!==t&&e.children.splice(t,1)},w=(e,r)=>{var o;const t=null===(o=e.children)||void 0===o?void 0:o.indexOf(r);void 0!==t&&-1!==t&&e.children.splice(t,1)},g=(e,r,o)=>{e.value=o},C=(e,r,o,t,n)=>{const{style:i,...a}=n;e.props=a,e.style=i},S=e=>{let{onChange:r=(()=>{})}=e;return p({appendChild:h,appendChildToContainer:y,commitTextUpdate:g,commitUpdate:C,createInstance:f,createTextInstance:v,insertBefore:T,removeChild:b,removeChildFromContainer:w,resetAfterCommit:r})};var N={version:"4.3.1"};const{version:_}=N,A=new l;let O;const L={},P=e=>{const r={type:"ROOT",document:null};O=O||S({onChange:()=>{var e;const r=(null===(e=L.change)||void 0===e?void 0:e.slice())||[];for(let e=0;e<r.length;e+=1)r[e]()}});const o=O.createContainer(r),t=(e,r)=>{O.updateContainer(e,o,null,r)};e&&t(e);const n=async function(e){void 0===e&&(e=!0);const o=r.document.props||{},{pdfVersion:t,language:n,pageLayout:i,pageMode:a,title:l,author:p,subject:m,keyboards:f,creator:v="react-pdf",producer:h="react-pdf",creationDate:y=new Date,modificationDate:T}=o,b=new d({compress:e,pdfVersion:t,lang:n,displayTitle:!0,autoFirstPage:!1,info:(w={Title:l,Author:p,Subject:m,Keywords:f,Creator:v,Producer:h,CreationDate:y,ModificationDate:T},Object.fromEntries(Object.entries(w).filter((e=>{let[,r]=e;return void 0!==r}))))});var w;i&&(b._root.data.PageLayout=u(i)),a&&(b._root.data.PageMode=u(a));const g=await s(r.document,A);return{layout:g,fileStream:c(b,g)}},i=function(e){void 0===e&&(e={}),r.document.props.onRender&&r.document.props.onRender(e)};return{on:(e,r)=>{L[e]||(L[e]=[]),L[e].push(r)},container:r,toBlob:async()=>{const e=[],{layout:r,fileStream:o}=await n();return new Promise(((t,n)=>{o.on("data",(r=>{e.push(r instanceof Uint8Array?r:new Uint8Array(r))})),o.on("end",(()=>{try{const o=new Blob(e,{type:"application/pdf"});i({blob:o,_INTERNAL__LAYOUT__DATA_:r}),t(o)}catch(e){n(e)}}))}))},toBuffer:async()=>{const{layout:e,fileStream:r}=await n();return i({_INTERNAL__LAYOUT__DATA_:e}),r},toString:async()=>{"development"===process.env.NODE_ENV&&console.warn("`toString` is deprecated and will be removed in next major release");let e="";const{fileStream:r}=await n(!1);return new Promise(((o,t)=>{try{r.on("data",(r=>{e+=r})),r.on("end",(()=>{i(),o(e)}))}catch(e){t(e)}}))},removeListener:(e,r)=>{if(!L[e])return;const o=L[e].indexOf(r);o>-1&&L[e].splice(o,1)},updateContainer:t}},D=A,x={create:e=>e},E=function(e){let{document:a}=void 0===e?{}:e;const l=o(null),[c,d]=t({url:null,blob:null,error:null,loading:!!a});n((()=>{const e=r({autostart:!0,concurrency:1}),o=()=>{d((e=>({...e,loading:!0}))),e.splice(0,e.length,(()=>c.error?Promise.resolve():l.current.toBlob()))};return l.current=P(),l.current.on("change",o),a&&l.current.updateContainer(a),e.on("error",(e=>{console.error(e),d((r=>({...r,loading:!1,error:e})))})),e.on("success",(e=>{d({blob:e,error:null,loading:!1,url:URL.createObjectURL(e)})})),()=>{e.end(),l.current.removeListener("change",o)}}),[]),n((()=>()=>{c.url&&URL.revokeObjectURL(c.url)}),[c.url]);const s=i((e=>{l.current.updateContainer(e)}),[]);return[c,s]},R=e=>{let{title:r,style:o,className:t,children:i,innerRef:a,showToolbar:l=!0,...c}=e;const[d,s]=E();n((()=>s(i)),[i]);const u=d.url?`${d.url}#toolbar=${l?1:0}`:null;return m("iframe",{src:u,title:r,ref:a,style:o,className:t,...c})},B=e=>{let{document:r,children:o}=e;const[t,i]=E();return n((()=>i(r)),[r]),r?o(t):(console.warn("You should pass a valid document to BlobProvider"),null)},U=a(((e,r)=>{let{fileName:o="document.pdf",document:t,children:i,onClick:a,href:l,...c}=e;const[d,s]=E();if(n((()=>s(t)),[t]),!t)return console.warn("You should pass a valid document to PDFDownloadLink"),null;return m("a",{href:d.url,download:o,onClick:e=>{d&&window.navigator.msSaveBlob&&window.navigator.msSaveBlob(d.blob,o),"function"==typeof a&&a(e,d)},ref:r,...c,children:"function"==typeof i?i(d):i})})),F=e=>{throw new Error(`${e} is a Node specific API. You're either using this method in a browser, or your bundler is not loading react-pdf from the appropriate web build.`)},I=()=>{F("renderToStream")},j=()=>{F("renderToBuffer")},k=()=>{F("renderToString")},Y=()=>{F("renderToFile")},V=()=>{F("render")};var $={pdf:P,usePDF:E,Font:D,version:_,StyleSheet:x,PDFViewer:R,BlobProvider:B,PDFDownloadLink:U,renderToStream:I,renderToString:k,renderToFile:Y,render:V,...e};export{B as BlobProvider,D as Font,U as PDFDownloadLink,R as PDFViewer,x as StyleSheet,S as createRenderer,$ as default,P as pdf,V as render,j as renderToBuffer,Y as renderToFile,I as renderToStream,k as renderToString,E as usePDF,_ as version};
